#compdef gwt grove
# Zsh completion for gwt
# Add to fpath or source directly

_gwt() {
  local -a options branches subcommands worktrees

  subcommands=(
    'list:List all worktrees'
    'remove:Remove a worktree'
    'update:Update grove to latest version'
  )

  options=(
    '-n[Create a new branch]'
    '-f[Custom folder name]:folder name:'
    '-l[Symlink env files instead of copying]'
    '--link[Symlink env files instead of copying]'
    '-s[Skip dependency installation]'
    '--skip[Skip dependency installation]'
    '-h[Show help]'
    '--help[Show help]'
    '-v[Show version]'
    '--version[Show version]'
  )

  # Handle subcommand completions
  if [[ "${words[2]}" == "remove" ]]; then
    # Complete worktree names for remove
    local gwt_dir="${GWT_DIR:-.worktrees}"
    if [[ -d "$gwt_dir" ]]; then
      worktrees=(${(f)"$(ls -1 "$gwt_dir" 2>/dev/null)"})
    fi
    _arguments '--force[Force remove dirty worktrees]' '*:worktree:($worktrees)'
    return
  fi

  if git rev-parse --git-dir &>/dev/null; then
    branches=(${(f)"$(git branch -a 2>/dev/null | sed 's/^[* ]*//' | sed 's/remotes\/origin\///' | sort -u)"})
  fi

  _arguments -s \
    $options \
    '1:command or branch:(${subcommands%%:*} $branches)'
}

_gwt "$@"
